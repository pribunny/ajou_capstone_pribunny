from langchain.prompts import PromptTemplate

# 독소조항 탐지 수정(++구체적인 법명 언급, 작성 지침 추가)
unfair_detect_template = PromptTemplate(
    input_variables=["context", "query"],
    template=(
        # 1. context(관련 법률)과 Instructions(개인정보처리방침 작성 가이드라인)을 기반으로 full_clause(개인정보처리방침 항목)와 맞지 않는 부분이 있는 지 확인
        # 2. 만약 존재한다면, 그 이유를 제시
        # 답변 : 맞지 않는 부분 제시 -> 왜 맞지 않는 지 이유 제시, 이유는 무조건 근거 법 조항을 기반으로 개인정보처리방침은 어떻게 작성되어야 한다 식의 서술
        # 만약 존재하지 않는다면, "해당 항목은 법률 및 개인정보처리방침 작성 가이드라인에 위반되는 사항이 없습니다" 출력하기.

        "You are a legal assistant tasked with analyzing clauses in a privacy policy to identify whether they are legally unfair or violate any laws.\\n\\n"
        "Analyze the clause based on the following two criteria:\\n"
        "1. 법적 기준 (Context): 아래 'Context'에 포함된 개인정보보호법, 개인정보보호법 시행령, 표준지침 등 법령\n"
        "2. 개인정보처리방침 및 수집·이용동의서 작성 가이드라인 (Guidelines): 개인정보처리방침을 작성할 때 준수해야 할 항목별 작성 기준\n\n"

        "분석 시 아래 원칙을 따르십시오:\n"
        "- Full_clause가 context에 포함된 법 조항을 위반한 경우:\n"
        "  해당 법 조항과 관련있는 가이드라인을 매핑하여,\n"
        "  개인정보처리방침 또는 수집·이용동의서가 어떻게 작성되어야 하는지를 다음 형식으로 서술하십시오:\n"
        "  개인정보처리방침은 ~~하게 작성되어야 합니다. 또는 수집·이용동의서는 ~~하게 작성되어야 합니다.\n\n"
        "- 반드시 위 문장을 포함한 서술형 설명으로 작성하십시오. 단순 법 조항 나열이 아닌, 조항의 의미와 그에 따른 작성 방식까지 명확히 설명하십시오.\n\n"
        
        "- Full_clause의 항목이 가이드라인 또는 법령이 요구하는 필수 기재사항을 누락한 경우도 위반으로 간주합니다.\n"
        "  제3자 제공 항목에서는 ‘제공받는 자’, ‘제공 목적’, ‘제공 항목’, ‘보유 및 이용 기간’ 모두 포함되어야 한다. 이때, 수집·이용동의서는 동의를 거부할 권리가 있다는 사실 및 동의 거부에 따른 불이익이 있는 경우에는 그 불이익의 내용까지 모두 포함되어야 한다.\n"
        "  국외 이전 항목에서는 ‘법적 근거', '이전 항목', '국가', '시기 및 방법', '이전받는 자', '이용 목적', '보유 기간', '거부 방법’ 모두 포함되어야 한다.\n"
        "  수탁 항목에서는 ‘위탁받은 자(수탁자)', '위탁하는 업무 내용’ 모두 포함되어야 한다.\n"
        "  하나라도 누락되었을 경우 관련 규정을 근거로 문제를 지적하십시오.\n\n"

        "- Full_clause가 아래의 경우에 해당하는 경우도 위반으로 간주합니다.\n"
        "  '동의함'이 기본값으로 설정되어 있는 경우\n"
        "  해당하는 경우 관련 규정을 근거로 문제를 지적하십시오.\n\n"

        "Full_clause:\n{question}\n\n"
        "Context (법적 기준):\n{context}\n\n"

        "Full_clause에 아무런 문제가 없는 경우, 다음 형식에 따라 json 형식으로 답변하십시오:\n"
        "isUnfair: false\n"

        "Full_clause가 context에 포함된 법률 조항을 위반한 경우, 다음 형식에 따라 json 형식으로 답변하십시오:\n"
        "isUnfair: true"
        "problemStatement: <문제가 되는 문장을 그대로 작성>\n"
        "reason: <위 원칙에 따라 서술된 문제 설명 포함>\n"
        "legalBasis: <근거 기준>\n"
        # "   - 관련 법령 조항: {law_clause}\n"
        # "※ 근거 기준 명시할 때 주의사항\n"
        # "- 관련 법령 조항은 반드시 이 {law_clause} 값을 그대로 출력해야 하며, 모델이 임의로 수정하거나 재조합하지 마십시오.\n"
        # "- 반드시 주어진 {law_clause} 형식으로 작성하십시오.\n"
        # "- 작성 가이드라인은 근거 기준에 포함하지 마십시오.\n\n"
        # "답변은 반드시1~3번 항목)까지만 포함되며, 그 외의 문장은 절대 작성하지 마십시오."
        

        "※ 작성 가이드라인:\n"
        "[필수 포함 항목]\n"
        "- 개인정보처리방침은 개인정보 처리 목적, 항목, 보유 기간, 파기 절차, 안전조치, 정보주체 권리, 보호책임자, 변경 이력을 반드시 포함해야 함\n"
        "- 수집·이용 동의서는 개인정보 처리 목적, 항목, 보유 기간, 동의를 거부할 권리가 있다는 사실 및 동의 거부에 따른 불이익이 있는 경우에는 그 불이익의 내용을 반드시 포함해야 함\n\n"
        "[개인정보의 처리 목적]\n"
        "- 구체적으로 작성하며 ‘~등’ 표현 금지. 고유식별정보는 법적 근거 또는 별도 동의 반드시 필요\n\n"
        "[처리하는 개인정보의 항목]\n"
        "- 수집 항목은 명확히 명시하고, 동의 여부와 법적 근거를 구분해 기재\n\n"
        "[14세 미만 아동의 개인정보 처리에 관한 사항 (권장, 해당 시)]\n"
        "- 법정대리인 동의 및 확인 방법을 반드시 포함\n\n"
        "[개인정보의 처리 및 보유 기간]\n"
        "- 목적별로 구체적인 보유 기간과 법적 근거 기재. ‘목적 달성 시까지’ 등 추상적 표현 지양\n\n"
        "[개인정보의 파기 절차 및 방법에 관한 사항]\n"
        "- 불필요 시 즉시 파기. 보존 시 법령과 항목 명시\n\n"
        "[개인정보의 제3자 제공에 관한 사항 (해당 시)]\n"
        "- 개인정보 처리방침은 제공받는 자, 목적, 항목, 보유기간 포함. ‘~등’ 축약 금지\n"
        "- 수집·이용 동의서는 제공받는 자, 목적, 항목, 보유기간, 동의를 거부할 권리가 있다는 사실 및 동의 거부에 따른 불이익이 있는 경우에는 그 불이익의 내용 포함. ‘~등’ 축약 금지.\n\n"
        "[추가적인 이용·제공이 지속적으로 발생 시 판단 기준 (해당 시)]\n"
        "- 동의 없는 이용 시 합리적 관련성과 법적 근거 포함 필요\n\n"
        "[개인정보 처리업무의 위탁에 관한 사항 (해당 시)]\n"
        "- 수탁자와 위탁 업무 구체 기재. 변경 시 즉시 반영\n\n"
        "[개인정보의 국외 수집 및 이전에 관한 사항 (해당 시)]\n"
        "- 개인정보 처리방침은 법적 근거, 항목, 국가, 시기, 이전자, 목적, 보유기간, 거부 방법 모두 명시\n"
        "- 수집·이용 동의서는 법적 근거, 항목, 국가, 시기, 이전자, 목적, 보유기간, 거부 방법, 동의를 거부할 권리가 있다는 사실 및 동의 거부에 따른 불이익이 있는 경우에는 그 불이익의 내용 모두 명시\n"
        "[개인정보의 안전성 확보조치에 관한 사항]\n"
        "- 시행 중인 기술·관리적 보호조치를 구체적으로 작성\n\n"
        "[민감정보의 공개 가능성 및 비공개를 선택하는 방법 (해당 시)]\n"
        "- 공개 여부 및 비공개 선택 방법 구체적으로 안내.\n\n"
        "[가명정보 처리에 관한 사항 (해당 시)]\n"
        "- 처리 목적, 기간, 제3자 제공, 위탁, 항목, 안전조치(법 제28조의4) 등을 포함, 위탁/제공 시 해당 항목 지침 준수\n\n"
        "[15. 개인정보 자동 수집 장치의 설치 운영 및 거부에 관한 사항 (해당 시)]\n"
        "- 쿠키 등 자동 수집 장치를 사용하는 경우, 수집 목적, 방법, 수집 항목, 거부 방법 구체적으로 명시\n"
        "[16. 제3자가 행태정보를 수집하도록 허용하는 경우 그 수집・이용 및 거부에 관한 사항 (권장, 해당 시)]\n"
        "- 웹/앱에서 제3자가 자동 수집 장치를 통해 행태정보를 수집하는 경우, 수집 항목, 사업자, 목적, 거부 방법 구체적으로 명시\n\n"
        "[17. 정보주체와 법정대리인의 권리・의무 및 행사 방법에 관한 사항]\n"
        "- 정보주체와 대리인의 권리(열람, 정정, 삭제, 처리 정지, 동의 철회 등)와 행사 방법을 구체적으로 명시\n\n"
        "[18. 개인정보 보호책임자 및 담당 부서 연락처에 관한 사항]\n"
        "- 법 제31조에 따라 지정된 개인정보 보호책임자와 업무 담당 부서, 연락처(전화, 이메일 등)를 기재\n\n"
        "[19. 국내대리인 지정에 관한 사항 (해당 시)]\n"
        "- 국외사업자는 법 제31조의2에 따라 국내대리인을 지정해야 하며, 성명(또는 법인명), 소재지, 연락처(전화, 이메일 등)를 기재\n\n"
        "[20. 정보주체의 권익침해에 대한 구제 방법 (권장)]\n"
        "- 정보주체가 침해 피해를 구제받을 수 있도록 전문기관, 수사기관 안내 및 연락처를 최신 상태로 기재\n\n"
        "[21. 고정형 영상정보처리기기 운영・관리 사항 (해당 시)]\n"
        "- 고정형 CCTV를 운영하는 경우, 법 제25조 및 시행령 제25조에 따라 운영관리방침을 포함하거나 별도로 공개해야 하며, 관련 항목을 개인정보처리방침에 포함할 수 있습니다.\n\n"
        "[22. 이동형 영상정보처리기기 운영・관리 사항 (해당 시)]\n"
        "- 이동형 CCTV를 운영하는 경우, 법 제25조의2 및 표준지침 제39조의3에 따라 운영관리방침을 작성하고, 개인정보처리방침에 포함할 수 있습니다.\n\n"
        "[23. 개인정보 처리방침의 변경에 관한 사항]\n"
        "- 변경 내용, 시행일, 이전 버전 명시. 주요 변경사항 고지 권장\n\n"

        "답변:"
        
    )
)

collect_data_template = PromptTemplate( #수집하는 항목 탐지
    input_variables= ["full_clause"],
    template = (
        # 들어온 clause에서 '수집하는 항목'을 모두 나열하라. (List 형태로 나열)
        # 수집하는 항목이 여러 개일 경우에도 '~등이 있다'로 표현하지 않고 모두 표시한다.
        # 수집하는 항목 중에서 사용자가 거부권을 행사할 수 있는 경우 '선택' 카테고리로, 사용자가 거부권을 행사할 수 있지만 서비스 이용에 제약을 받는 경우 '필수' 카테고리에 넣어라
        # '선택'과 '필수' 카테고리를 json 형식으로 반환하라. ex. {{'선택' : '선택 카테고리에 해당하는 항목 전체'}, {'필수' : '필수 카테고리에 해당하는 항목 전체'}}
        # '회원가입단계'에서 '수집하는 개인정보 항목 동의'를 받는 조항에 대해 진행한다 -> 필수, 선택, 고유식별정보 및 민감정보로 나누어 사용자에게 보여준다.
        # 들어온 clause에서 사용자에게 '필수'로 제공받는 개인정보 항목을 '필수' 카테고리에 묶어 List 형태로 나열하라.
        #   - 이때, 필수 조항들과는 다르게 별도로 필수 조항을 확인 받는 경우, 민감 정보나 고유식별 정보에 묶여있는 경우 '고유식별정보 및 민감정보' 카테고리에 묶어라.
        # 들어온 clause에서 사용자에게 개인정보 항목을 받을 때 '선택'을 받는 항목을 '선택' 카테고리에 묶어 List 형태로 나열하라.
        # 필수, 선택, 고유식별정보 및 민감정보 카테고리와 그 내용들을 Json 형식으로 반환하라. ex. {{'선택' : '성별, 나이'}, {'필수' : '이름, 주소지'}, {'고유식별정보 및 민감정보':'주민등록번호, 여권번호'}}
        #   - 이때, 카테고리에 포함된 단어들은 '~등'으로 내용을 축약하지 않고 모두 반환한다.

        "You are analyzing a clause from a privacy policy.\n"
        "Your task is to extract **all types of personal information** that are collected from users in the clause.\n\n"

        "Instructions:\n"
        "1. List all data items being collected. Do not summarize using expressions like '~등' – list every item explicitly.\n"
        "2. Classify the collected data into the following categories:\n"
        "   - '선택': If the user can opt out without losing service access.\n"
        "   - '필수': If the user must provide the data to use the service.\n"
        "   - '민감/고유식별정보': If the clause explicitly asks for sensitive data (e.g. 여권번호, 주민등록번호) or requires separate consent for sensitive/unique identifiers.\n"
        "3. Return your answer in proper JSON format as shown below:\n"
        "{\n"
        "  \"선택\": [\"Gender\", \"Age\"],\n"
        "  \"필수\": [\"Name\", \"Address\"],\n"
        "  \"민감/고유식별정보\": [\"Resident Registration Number\", \"Passport Number\"]\n"
        "}\n\n"

        "If a category has no applicable items, return the string \"해당 항목이 없습니다.\" for that category instead of a list.\n"
        "Your response must not include explanations — only the JSON result.\n"
    )
)
