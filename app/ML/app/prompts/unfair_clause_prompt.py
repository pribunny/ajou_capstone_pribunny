from langchain.prompts import PromptTemplate

# 독소조항 탐지 수정(++구체적인 법명 언급, 작성 지침 추가)
unfair_detect_template = PromptTemplate(
    input_variables=["context", "question"],
    template=(
        # 1. context(관련 법률)과 Instructions(개인정보처리방침 작성 가이드라인)을 기반으로 full_clause(개인정보처리방침 항목)와 맞지 않는 부분이 있는 지 확인
        # 2. 만약 존재한다면, 그 이유를 제시
        # 답변 : 맞지 않는 부분 제시 -> 왜 맞지 않는 지 이유 제시, 이유는 무조건 근거 법 조항을 기반으로 개인정보처리방침은 어떻게 작성되어야 한다 식의 서술
        # 만약 존재하지 않는다면, "해당 항목은 법률 및 개인정보처리방침 작성 가이드라인에 위반되는 사항이 없습니다" 출력하기.

        "당신은 개인정보처리방침의 항목을 분석하여 법적으로 불공정하거나 위법한 내용이 있는지 확인하는 법률 어시스턴트입니다.\n\n"
        "다음의 두 가지 기준을 바탕으로 항목을 분석하십시오:\n"
        "1. 법적 기준 (Context): 아래 'Context'에 포함된 개인정보보호법, 개인정보보호법 시행령, 표준지침 등 법령\n"
        "2. 개인정보처리방침 작성 가이드라인 (Guidelines): 개인정보처리방침을 작성할 때 준수해야 할 항목별 작성 기준\n\n"

        "분석 시 아래 원칙을 따르십시오:\n"
        "- Full_clause가 context에 포함된 법 조항을 위반한 경우:\n"
        "  해당 법 조항과 관련있는 개인정보처리방침 작성 가이드라인을 매핑하여,\n"
        "  개인정보처리방침이 어떻게 작성되어야 하는지를 다음 형식으로 서술하십시오:\n"
        "  {law} {clause}에 따르면, 개인정보처리방침은 ~~하게 작성되어야 합니다.\n\n"
        "- 반드시 위 문장을 포함한 서술형 설명으로 작성하십시오. 단순 법 조항 나열이 아닌, 조항의 의미와 그에 따른 작성 방식까지 명확히 설명하십시오.\n\n"
        "- Full_clause의 항목이 개인정보처리방침 작성 가이드라인 또는 법령이 요구하는 필수 기재사항을 누락한 경우도 위반으로 간주합니다.\n"
        "  제3자 제공 항목에서는 ‘제공받는 자’, ‘제공 목적’, ‘제공 항목’, ‘보유 및 이용 기간’ 등이 모두 포함되어야 하며, \n"
        "  국외 이전 항목에서는 ‘법적 근거', '이전 항목', '국가', '시기 및 방법', '이전받는 자', '이용 목적', '보유 기간', '거부 방법’ 등이 모두 포함되어야 하며, \n"
        "  수탁 항목에서는 ‘위탁받은 자(수탁자)', '위탁하는 업무 내용’ 등이 모두 포함되어야 하며, \n"
        "  하나라도 누락되었을 경우 관련 규정을 근거로 문제를 지적하십시오.\n\n"

        "Full_clause:\n{question}\n\n"
        "Context (법적 기준):\n{context}\n\n"

        "Full_clause가 context에 포함된 법률 조항을 위반한 경우, 다음 형식에 따라 답변하십시오:\n"
        "1) 문제 표현: <문제가 되는 문장을 그대로 작성>\n"
        "2) 문제 이유: <위 원칙에 따라 서술된 문제 설명 포함>\n"
        "3) 근거 기준:\n"
        "   - 관련 법령 조항: {law} {clause}\n"
        "※ 근거 기준 명시할 때 주의사항\n"
        "- 관련 법령 조항은 제공된 Context 안의 내용을 기반으로 판단하시오.\n"
        "- 문제 이유를 참고하여 가장 적절한 법령명과 조문을 {law} {clause} 형식으로 작성하십시오.\n"
        "- 개인정보처리방침 작성 가이드라인은 근거 기준에 포함하지 마십시오.\n\n"

        "Full_clause에 아무런 문제가 없는 경우, 다음과 같이 작성하십시오:\n"
        "'해당 항목은 법률 및 개인정보처리방침 작성 가이드라인에 위반되는 사항이 없습니다.'\n"

        "※ 개인정보처리방침 작성 가이드라인:\n"
        "[1. 필수 포함 항목]\n"
        "- 개인정보처리방침에는 반드시 다음 항목들이 포함되어야 합니다:\n"
        "  • 개인정보의 처리 목적\n"
        "  • 처리하는 개인정보의 항목\n"
        "  • 개인정보의 보유 및 이용 기간\n"
        "  • 개인정보의 파기 절차 및 방법\n"
        "  • 개인정보의 안전성 확보조치\n"
        "  • 정보주체와 법정대리인의 권리 및 행사 방법\n"
        "  • 개인정보 보호책임자 및 담당 부서 정보\n"
        "  • 개인정보 처리방침의 변경 이력\n\n"
        "[2. 제목]\n"
        "- 개인정보처리방침 문서 상단에는 반드시 “개인정보 처리방침”이라는 표준 명칭을 사용해야 합니다.\n\n"
        "[3. 개인정보의 처리 목적]\n"
        "- 처리 목적은 구체적이고 명확하게 작성해야 하며, '~등'과 같은 모호한 표현을 사용해서는 안 됩니다.\n"
        "- 고유식별정보는 개인정보 보호법 제24조제1항에 따라, 법령에 의한 명확한 근거가 있거나, 별도의 동의를 받은 경우에만 처리할 수 있습니다.\n\n"
        "[4. 처리하는 개인정보의 항목]\n"
        "- 수집하는 개인정보 항목은 명확히 나열되어야 하며, '~등'과 같은 추상적·모호한 표현은 금지됩니다.\n"
        "- 정보주체의 동의 없이 수집하는 항목이 있을 경우, 해당 항목과 그 처리의 법적 근거를 명확히 기재하고, 동의 기반 항목과 구분해야 합니다.\n"
        "- 법적 근거를 작성할 때는 법령명뿐만 아니라 조문까지 구체적으로 명시해야 합니다.\n"
        "- 업무 수행 또는 서비스 제공 중 자동으로 수집되는 항목이 있다면, 어떤 업무 과정에서 어떤 항목이 수집되는지를 함께 명시해야 합니다.\n"
        "[5. 14세 미만 아동의 개인정보 처리에 관한 사항 (권장, 해당 시)]\n"
        "- 아동의 개인정보를 동의를 받아 처리하고자 하는 경우, 법정대리인의 동의를 얻어 개인정보를 수집한다는 내용 및 법정대리인 동의 확인방법 등을 기재해야 합니다.\n"
        "- 법정대리인의 동의 확인 방법은 법령의 문구를 그대로 나열하는 것이 아니라, 개인정보처리자가 실제로 사용하는 방법을 구체적으로 작성해야 합니다.\n"
        "- 개인정보처리자가 아동으로부터 수집하는 법정대리인의 개인정보(이름, 연락처 등)는 반드시 명시해야 하며, 이는 개인정보 보호법 제22조의2에 근거합니다.\n"
        "- 법정대리인의 동의 없이 아동으로부터 직접 수집하는 법정대리인의 개인정보는 ‘처리하는 개인정보 항목’에 포함하여 기재할 수 있습니다.\n"
        "- 서비스의 주된 이용 대상이 14세 미만 아동인 경우, 이해하기 쉬운 양식과 명확한 언어로 작성된 ‘아동용 개인정보처리방침’을 별도로 마련하여 안내해야 합니다.\n\n"
        "[6. 개인정보의 처리 및 보유 기간]\n"
        "- 정보주체로부터 동의받은 ‘보유·이용 기간’ 또는 법령에 따른 보유 기간을 바탕으로 개인정보를 보유할 수 있다는 내용을 기재해야 합니다.\n"
        "- ‘개인정보 처리 목적’에서 작성한 업무별로 구체적인 처리·보유 기간을 각각 명시해야 합니다.\n"
        "- 보유 기간의 법적 근거가 있는 경우, 해당 법령명 및 조문, 적용 항목, 그리고 구체적인 보유 기간을 함께 기재해야 합니다.\n"
        "- ‘목적 달성 시까지’와 같이 추상적인 표현은 피하고, 동의 항목과 일치하는 구체적인 기간을 명확하게 작성해야 합니다.\n\n"
        "[7. 개인정보의 파기 절차 및 방법에 관한 사항]\n"
        "- 개인정보가 불필요하게 된 경우 지체 없이 파기한다는 원칙을 반드시 기재해야 합니다.\n"
        "- 법령에 따라 파기하지 않고 보존하는 경우, 해당 법령명과 조문, 그리고 보존하는 개인정보 항목을 명시해야 합니다.\n"
        "  (단, 해당 내용이 ‘개인정보의 처리 및 보유 기간’ 항목에 이미 구체적으로 기재되어 있다면 중복 기재하지 않아도 됩니다.)\n"
        "- 파기의 절차, 시점, 방법 등을 포함하여 가능한 구체적으로 작성해야 합니다.\n\n"
        "[8. 개인정보의 제3자 제공에 관한 사항 (해당 시)]\n"
        "- 제3자 제공이 있을 경우 반드시 개인정보처리방침에 해당 사항을 기재해야 합니다.\n"
        "- ‘개인정보 제공’이란 물리적 전송뿐 아니라 접근 권한 부여, 공유 등 모든 이전 및 공동 이용 상태를 포함합니다.\n"
        "- 제3자 제공 시, 법적 근거가 있다면 개인정보 보호법 제17조, 제18조에 따른 요건을 충족해야 하며, 제공 목적, 항목, 보유·이용 기간 등을 명확히 기재해야 합니다.\n"
        "- 국외 제공이 포함된 경우, ‘개인정보의 국외 수집 및 이전에 관한 사항’에서 통합 작성할 수 있습니다.\n"
        "- 수탁자 및 제공받는 자는 ‘~등’ 또는 ‘A업체 등 O개사’와 같이 축약하지 않아야 하며, 제공받는 자가 많은 경우 더보기/팝업/링크 형태로 별도 공개할 수 있습니다.\n\n"
        "[9. 추가적인 이용·제공이 지속적으로 발생 시 판단 기준 (해당 시)]\n"
        "- 당초 수집 목적과 합리적으로 관련된 범위 내에서, 동의 없이 추가 이용·제공이 계속 발생하는 경우에는 해당 기준을 개인정보처리방침에 구체적으로 작성해야 합니다.\n"
        "- 개인정보 보호법 제15조제3항 및 제17조제4항, 시행령 제14조의2 제1항에 따른 고려사항을 함께 포함시켜, 제공받는 자, 제공 항목, 이용 목적, 보유 기간 등을 상세히 기재해야 합니다.\n\n"
        "[10. 개인정보 처리업무의 위탁에 관한 사항 (해당 시)]\n"
        "- 개인정보 처리 업무를 외부 제3자에게 위탁하고 있다면, 위탁받은 자(수탁자) 및 위탁하는 업무 내용을 반드시 기재해야 합니다.\n"
        "- 재위탁이 있는 경우, 개인정보처리자는 수탁자의 개인정보처리방침 링크 등을 통해 재수탁자 정보를 안내할 수 있습니다.\n"
        "- 해외 법인이 국내 고객 정보를 활용하는 경우, 이는 국외 이전 위탁에 해당하며 ‘국외 수집 및 이전’ 항목에서 명시할 수 있습니다.\n"
        "- 위탁 내용이나 수탁자가 변경될 경우, 개인정보처리방침을 지체 없이 업데이트해야 합니다.\n"
        "- 수탁자 및 위탁 업무 내용은 ‘~등’으로 축약하지 않고 구체적으로 기재해야 하며, 수탁자가 많을 경우 별도 화면이나 다운로드 링크 등으로 공개할 수 있습니다.\n\n"
        "[11. 개인정보의 국외 수집 및 이전에 관한 사항 (해당 시)]\n"
        "- 해당 시 '개인정보의 국외 수집 및 이전에 관한 사항'을 개인정보처리방침에 작성해야 합니다.\n"
        "- 개인정보의 국외 수집・이전(제공, 처리위탁, 보관)은 정보주체의 개인정보가 국내와 개인정보 보호 체계가 다른 제3의 국가로 옮겨지는 것이므로, 정보주체가 이를 명확히 인지할 수 있도록 개인정보의 제3자 제공, 처리업무의 위탁 등 항목과 별도로 구분하여 기재해야 합니다.\n"
        "- 국외에서 직접 수집하는 경우에는 그 사실과 함께 수집 국가를 명확히 기재해야 하며, 이는 한국 개인정보 보호법의 적용을 받는 경우에 해당합니다.\n"
        "- 국외로 이전하는 경우에는 개인정보보호법 제28조의8 제1항 및 제2항에 따른 법적 근거, 이전 항목, 국가, 시기 및 방법, 이전받는 자, 이용 목적, 보유 기간, 거부 방법 등을 모두 명시해야 합니다.\n"
        "- 클라우드 등을 통해 복수 국가로 이전되는 경우에도 모든 국가를 기재해야 합니다.\n"
        "- 국외 이전에 대한 별도 법령이 있는 경우 그 법령명과 조문도 명시해야 합니다.\n"
        "- 국외 제3자 제공 또는 국외 위탁인 경우 해당 사실과 관련 법 조항을 함께 작성해야 하며, 이를 ‘국외 수집 및 이전’ 항목에 통합 기재할 수 있습니다.\n\n"
        "[12. 개인정보의 안전성 확보조치에 관한 사항]\n"
        "- 개인정보처리자는 개인정보보호법 제29조, 시행령 제30조 및 제30조의2에 따라 시행 중인 안전조치를 구체적으로 기재해야 합니다.\n"
        "- 다만, 기술적 조치가 알려지는 것이 보안상 위험을 초래할 수 있다고 판단되는 경우에는 그 수준을 조절하여 표현할 수 있습니다.\n\n"
        "[13. 민감정보의 공개 가능성 및 비공개를 선택하는 방법 (해당 시)]\n"
        "- 민감정보가 공개될 수 있는 경우, 그 사실과 함께 비공개 선택 방법을 명확히 안내해야 합니다.\n"
        "- 공개될 수 있는 항목을 모두 명시하고, 비공개 방법과 절차도 구체적으로 기재해야 합니다.\n"
        "- SNS, 게시판 등 사용자가 직접 입력하는 공개 공간은 예외로 판단할 수 있습니다.\n\n"
        "[14. 가명정보 처리에 관한 사항 (해당 시)]\n"
        "- 가명정보를 처리하는 경우, 처리 목적, 기간, 제3자 제공, 위탁, 항목, 안전조치(법 제28조의4) 등을 구체적으로 기재해야 합니다.\n"
        "- 제3자 제공과 위탁은 해당 항목의 작성 지침을 따릅니다.\n\n"
        "[15. 개인정보 자동 수집 장치의 설치 운영 및 거부에 관한 사항 (해당 시)]\n"
        "- 쿠키 등 자동 수집 장치를 사용하는 경우, 수집 목적, 방법, 수집 항목, 거부 방법 등을 기재해야 합니다.\n"
        "- 행태정보를 수집하거나 제3자에게 제공하는 경우, 그 항목, 목적, 수단, 기간, 법적 근거 등을 모두 명시해야 합니다.\n"
        "- 정보주체 식별 여부에 따라 개인정보로 분류될 수 있으므로 주의해야 하며, 거부 방법은 PC/모바일 기기에 따라 구체적으로 안내해야 합니다.\n\n"
        "[16. 제3자가 행태정보를 수집하도록 허용하는 경우 그 수집・이용 및 거부에 관한 사항 (권장, 해당 시)]\n"
        "- 웹/앱에서 제3자가 자동 수집 장치를 통해 행태정보를 수집하는 경우, 수집 항목, 사업자, 목적, 거부 방법 등을 명시해야 합니다.\n"
        "- 차단 방법은 사용 기기에 따라 정확하게 안내해야 합니다.\n\n"
        "[17. 정보주체와 법정대리인의 권리・의무 및 행사 방법에 관한 사항]\n"
        "- 정보주체와 대리인의 권리(열람, 정정, 삭제, 처리 정지, 동의 철회 등)와 행사 방법을 구체적으로 작성해야 합니다.\n"
        "- 홈페이지가 있는 경우, 해당 기능 안내 및 양식 제공 방법도 설명해야 합니다.\n"
        "- 실제 절차와 방법이 간편하게 작성되어야 하며, 법 제38조 제4항에 따라 수집 절차보다 어렵지 않아야 합니다.\n\n"
        "[18. 개인정보 보호책임자 및 담당 부서 연락처에 관한 사항]\n"
        "- 법 제31조에 따라 지정된 개인정보 보호책임자와 업무 담당 부서, 연락처(전화, 이메일 등)를 기재해야 합니다.\n"
        "- 정보주체가 연락 시 과도한 지연이 없도록 유효한 정보로 제공해야 합니다.\n\n"
        "[19. 국내대리인 지정에 관한 사항 (해당 시)]\n"
        "- 국외사업자는 법 제31조의2에 따라 국내대리인을 지정해야 하며, 성명(또는 법인명), 소재지, 연락처(전화, 이메일 등)를 기재해야 합니다.\n\n"
        "[20. 정보주체의 권익침해에 대한 구제 방법 (권장)]\n"
        "- 정보주체가 침해 피해를 구제받을 수 있도록 전문기관, 수사기관 안내 및 연락처를 최신 상태로 기재하는 것이 권장됩니다.\n"
        "- 자체 구제가 어려운 경우 추가적인 구제 수단도 안내해야 합니다.\n\n"
        "[21. 고정형 영상정보처리기기 운영・관리 사항 (해당 시)]\n"
        "- 고정형 CCTV를 운영하는 경우, 법 제25조 및 시행령 제25조에 따라 운영관리방침을 포함하거나 별도로 공개해야 하며, 관련 항목을 개인정보처리방침에 포함할 수 있습니다.\n\n"
        "[22. 이동형 영상정보처리기기 운영・관리 사항 (해당 시)]\n"
        "- 이동형 CCTV를 운영하는 경우, 법 제25조의2 및 표준지침 제39조의3에 따라 운영관리방침을 작성하고, 개인정보처리방침에 포함할 수 있습니다.\n\n"
        "[23. 개인정보처리자가 자율적으로 정한 개인정보 보호조치 사항 (권장)]\n"
        "- 개인정보처리자가 법령 외에 자율적으로 수행 중인 보호조치(ISMS-P 인증, 영향평가 등)를 기재할 수 있습니다.\n\n"
        "[24. 개인정보 처리방침의 변경에 관한 사항]\n"
        "- 개인정보 처리방침 변경 시 변경 내용, 시행일자를 기재하고 이전 버전 이력도 함께 공개해야 합니다.\n"
        "- 변경 내용을 비교하거나 알림 팝업 등을 통해 주요 변경 사항을 별도로 고지하는 것도 권장됩니다.\n\n"


        "답변:"

    )
)

collect_data_template = PromptTemplate( #수집하는 항목 탐지
    input_variables= ["full_clause"],
    template = (
        # 들어온 clause에서 '수집하는 항목'을 모두 나열하라. (List 형태로 나열)
        # 수집하는 항목이 여러 개일 경우에도 '~등이 있다'로 표현하지 않고 모두 표시한다.
        # 수집하는 항목 중에서 사용자가 거부권을 행사할 수 있는 경우 '선택' 카테고리로, 사용자가 거부권을 행사할 수 있지만 서비스 이용에 제약을 받는 경우 '필수' 카테고리에 넣어라
        # '선택'과 '필수' 카테고리를 json 형식으로 반환하라. ex. {{'선택' : '선택 카테고리에 해당하는 항목 전체'}, {'필수' : '필수 카테고리에 해당하는 항목 전체'}}
        # '회원가입단계'에서 '수집하는 개인정보 항목 동의'를 받는 조항에 대해 진행한다 -> 필수, 선택, 고유식별정보 및 민감정보로 나누어 사용자에게 보여준다.
        # 들어온 clause에서 사용자에게 '필수'로 제공받는 개인정보 항목을 '필수' 카테고리에 묶어 List 형태로 나열하라.
        #   - 이때, 필수 조항들과는 다르게 별도로 필수 조항을 확인 받는 경우, 민감 정보나 고유식별 정보에 묶여있는 경우 '고유식별정보 및 민감정보' 카테고리에 묶어라.
        # 들어온 clause에서 사용자에게 개인정보 항목을 받을 때 '선택'을 받는 항목을 '선택' 카테고리에 묶어 List 형태로 나열하라.
        # 필수, 선택, 고유식별정보 및 민감정보 카테고리와 그 내용들을 Json 형식으로 반환하라. ex. {{'선택' : '성별, 나이'}, {'필수' : '이름, 주소지'}, {'고유식별정보 및 민감정보':'주민등록번호, 여권번호'}}
        #   - 이때, 카테고리에 포함된 단어들은 '~등'으로 내용을 축약하지 않고 모두 반환한다.

        "You are analyzing a clause from a privacy policy.\n"
        "Your task is to extract **all types of personal information** that are collected from users in the clause.\n\n"

        "Instructions:\n"
        "1. List all data items being collected. Do not summarize using expressions like '~등' – list every item explicitly.\n"
        "2. Classify the collected data into the following categories:\n"
        "   - '선택': If the user can opt out without losing service access.\n"
        "   - '필수': If the user must provide the data to use the service.\n"
        "   - '민감/고유식별정보': If the clause explicitly asks for sensitive data (e.g. 여권번호, 주민등록번호) or requires separate consent for sensitive/unique identifiers.\n"
        "3. Return your answer in proper JSON format as shown below:\n"
        "{\n"
        "  \"선택\": [\"Gender\", \"Age\"],\n"
        "  \"필수\": [\"Name\", \"Address\"],\n"
        "  \"민감/고유식별정보\": [\"Resident Registration Number\", \"Passport Number\"]\n"
        "}\n\n"

        "If a category has no applicable items, return the string \"해당 항목이 없습니다.\" for that category instead of a list.\n"
        "Your response must not include explanations — only the JSON result.\n"
    )
)